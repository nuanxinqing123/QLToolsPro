import{N as e,k as a,w as t,f as s,a4 as l,a6 as o,c as i,a8 as r,u,L as n,a3 as p,r as m,q as d,i as c,F as v,J as f}from"./@vue-11129043.js";import{p as j}from"./p-center-modal-916ba484.js";import"./dayjs-c306acb6.js";import{J as b,K as y,L as g}from"./index-9781d2dc.js";import{m as h,F as _,E as x}from"./ant-design-vue-93fc40b2.js";import{_ as k}from"./page-container-94b32927.js";import{d as S}from"./common-3c8652c5.js";import"./pinia-1ca0c29b.js";import"./vue-demi-a81ff0a7.js";import"./store-325aa5d6.js";import"./_plugin-vue_export-helper-9b9a8a5b.js";import"./@babel-eab0ef53.js";import"./axios-93d3568f.js";import"./qs-8fb0a9f1.js";import"./side-channel-ee547e73.js";import"./get-intrinsic-53528089.js";import"./has-symbols-1f359e75.js";import"./function-bind-c930bb92.js";import"./has-03e8e28c.js";import"./call-bind-566c57e8.js";import"./object-inspect-5c6480f3.js";import"./vue-router-36397834.js";import"./vue3-colorpicker-e1559e09.js";import"./vue-types-0fd36d85.js";import"./is-plain-object-39134198.js";import"./tinycolor2-e232e212.js";import"./@vueuse-94329f85.js";import"./@aesoper-316802a3.js";import"./vue3-angle-2884cf46.js";import"./gradient-parser-c9367eab.js";import"./lodash-es-0ceb8576.js";import"./@popperjs-31624eb1.js";import"./resize-observer-polyfill-9cd09a67.js";import"./@ant-design-477981d5.js";import"./@ctrl-16df70a4.js";import"./dom-align-6a5270eb.js";import"./async-validator-604317c1.js";import"./scroll-into-view-if-needed-8ce8502d.js";import"./compute-scroll-into-view-cce79123.js";const U=n("取消"),w=n("提交"),D={__name:"pop",props:{dataObj:Object,visible:Boolean},emits:["update:visible","updateData"],setup(n,{emit:m}){const d=n,{visible:c,dataObj:v}=e(d),f=()=>{m("update:visible",!1)},g=a({message:""}),_={message:[{required:!0,trigger:"change"}]},x=e=>{},k=(...e)=>{},S={labelCol:{span:7},wrapperCol:{span:15}},D=e=>{let a=null,t={...g};v.value?(t.user_wxpusher=v.value,a=b):a=y,a({data:t}).then((()=>{h.success("操作成功"),m("updateData",t),f()}))};return t(c,((e,a,t)=>{c.value&&(g.message="")})),(e,a)=>{const t=p("a-textarea"),n=p("a-form-item"),m=p("a-button"),d=p("a-form");return s(),l(j,{modalVisible:u(c),isFooter:!1,onClose:f,title:"消息群发"},{content:o((()=>[i(d,r({ref:"formRef",name:"custom-validation",model:g,rules:_},S,{onValidate:k,onFinishFailed:x,onFinish:D}),{default:o((()=>[i(n,{label:"消息内容",name:"message"},{default:o((()=>[i(t,{value:g.message,"onUpdate:value":a[0]||(a[0]=e=>g.message=e),placeholder:"请输入消息内容"},null,8,["value"])])),_:1}),i(n,{"wrapper-col":{span:12,offset:12},class:"timed-start-button"},{default:o((()=>[i(m,{onClick:f},{default:o((()=>[U])),_:1}),i(m,{type:"primary",style:{"margin-left":"20px"},"html-type":"submit"},{default:o((()=>[w])),_:1})])),_:1})])),_:1},16,["model"])])),_:1},8,["modalVisible"])}}},C=n(" 消息群发 "),I=n(" 全体消息发送 "),A={__name:"index",setup(e){const t=m({}),l=m(!1),r=_.useForm,n=m(0),j=m(1),b=m(10);x.PRESENTED_IMAGE_SIMPLE;const y=a({s:""}),U=m(!1);r(y);const w=[{title:"用户UID",dataIndex:"UserID"},{title:"用户名",dataIndex:"Username"},{title:"用户WxpusherID",dataIndex:"UserWxpusher"}],A=m([]),F=e=>{if(e)t.value=null;else{if(!O.value.length)return void h.error("请先选择用户");t.value=z.value.map((e=>e.UserWxpusher))}l.value=!0},E=e=>{e&&(j.value=1);let a={page:j.value,quantity:b.value};g({data:y,splicingData:a}).then((e=>{U.value?n.value=0:n.value=e.page*b.value,A.value=(e.pageData||e||[]).map((e=>(e.key=e.UserID,e.CreatedAt&&(e.CreatedAt=S(e.CreatedAt)),e.UpdatedAt&&(e.UpdatedAt=S(e.UpdatedAt)),e)))}))},O=m([]),z=m([]),q=(e,a)=>{a?(O.value.push(e.key),z.value.push(e)):(O.value=O.value.filter((a=>e.key!=a)),z.value=z.value.filter((a=>a.key!=e.key)))},R=(e,a,t)=>{const s=t.map((e=>e.key));if(e){let e=O.value;for(const a of s){const s=t.filter((e=>e.key==a))[0]||{};e.includes(a)||(e.push(a),z.value.push(s))}O.value=[],setTimeout((()=>{O.value=e}))}else O.value=O.value.filter((e=>!s.includes(e))),z.value=z.value.filter((e=>!s.includes(e.key)))},L=d((()=>({onSelect:q,selectedRowKeys:u(O),onSelectAll:R,selections:[{key:"odd",text:"清除当前页选择",onSelect:()=>{const e=A.value.map((e=>e.key));O.value=O.value.filter((a=>!e.includes(a))),z.value=z.value.filter((a=>!e.includes(a.key)))}},{key:"odd",text:"清除所有选择",onSelect:()=>{O.value=[],z.value=[]}}]})));return(e,a)=>{const r=p("a-button"),m=p("a-form-item"),d=p("a-form");return s(),c(v,null,[i(D,{visible:l.value,"onUpdate:visible":a[0]||(a[0]=e=>l.value=e),dataObj:t.value,onUpdateData:E},null,8,["visible","dataObj"]),i(k,{columns:w,isRowSelection:"","row-selection":u(L),pageSize:b.value,"onUpdate:pageSize":a[3]||(a[3]=e=>b.value=e),current:j.value,"onUpdate:current":a[4]||(a[4]=e=>j.value=e),total:n.value,"onUpdate:total":a[5]||(a[5]=e=>n.value=e),isTable:!0,isSearch:!0,onOnShowSizeChange:E,onInitData:E,dataSource:A.value},{search:o((()=>[i(d,{class:"flex flex-warp",model:y},{default:o((()=>[i(m,null,{default:o((()=>[i(r,{type:"primary",onClick:a[1]||(a[1]=f((e=>F()),["prevent"])),class:"filter-search"},{default:o((()=>[C])),_:1})])),_:1}),i(m,null,{default:o((()=>[i(r,{type:"primary",onClick:a[2]||(a[2]=f((e=>F(!0)),["prevent"])),style:{"margin-left":"15px"},class:"filter-search"},{default:o((()=>[I])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["row-selection","pageSize","current","total","dataSource"])],64)}}};export{A as default};
